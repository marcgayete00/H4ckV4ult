<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Maven+Pro:wght@400..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/H4ckV4ult/styles/navBarStyles.css">
    <link rel="stylesheet" href="/H4ckV4ult/styles/walkthroughs.css">
        <link href="/H4ckV4ult/styles/prism/prism.css" rel="stylesheet" />
    <script src="/H4ckV4ult/styles/prism/prism.js"></script>
    <title>Minimalist Webpage</title>

</head>
<body>
    <div id="navbar-container"></div>
    <script src="/H4ckV4ult/components/navbar.js"></script>

    <div class="notion-container">
        <div class="notion-header">
            <h1>DNS - Domain Name Server (TCP/53)</h1>
            <p>A Domain Name System (DNS) turns domain names into IP addresses, which allow browsers to get to websites and other internet resources.</p>
        </div>
        <p>A little bit of theory of different DNS records</p>
        <p><b>A</b> records: We recognize the IP addresses that point to a specific (sub)domain through the A record. Here we only see one that we already know.
        <p><b>MX records</b>: The mail server records show us which mail server is responsible for managing the emails for the company. Since this is handled by google in our case, we should note this and skip it for now.</p>
        <p><b>NS records</b>: These kinds of records show which name servers are used to resolve the FQDN to IP addresses. Most hosting providers use their own name servers, making it easier to identify the hosting provider.</p>
        <p><b>TXT records</b>: this type of record often contains verification keys for different third-party providers and other security aspects of DNS, such as SPF, DMARC, and DKIM, which are responsible for verifying and confirming the origin of the emails sent. Here we can already see some valuable information if we look closer at the results.</p>

        <div class="notion-body">
            <h2>Enumeration</h2>
            <ul>
                <p>Getting DNS records</p>
                <pre><code class="language-bash">dig any inlanefreight.com</code></pre>
                <p>DNS lookup <a class="notion-link" href="https://dnsdumpster.com/">dnsdumpster</a></p>
                <p>DNS lookup <a class="notion-link" href="https://domain.glass/">Domain Glass</a></p>
                <p>Lookup anything about a website <a class="notion-link" href="https://buckets.grayhatwarfare.com/">gray hat warfare</a></p>
                <p>Find information about the domain <a class="notion-link" href="https://search.censys.io/">Censys </a></p>
                <p>Find certifcate logs (issued subdomains) <a class="notion-link" href="https://crt.sh/">crt.sh</a></p>
                <p>Other ways to perform DNS lookup</p>
                <pre><code class="language-bash">dig any inlanefreight.htb @10.129.242.130</code></pre>
                <h3>Automation</h3>
                <p>We can automate the process of finding subodmains by using the following tool. Wordlists that may come handy (fierce-hostlist.txt)</p>
                <pre><code class="language-bash">dnsenum --enum inlanefreight.com -f  /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt </code></pre>
                <p>Other alternatives</p>
                <pre><code class="language-bash">./subfinder -d inlanefreight.com -v  </code></pre>
                
            </ul>

            <h2>Exploitation</h2>
            <ul>
                <h3>DNS zone transfer attack</h3>
                <ul>
                <p>DNS is configured to be able to tranfer domain names to other domain name servers. This may be done due reduce load or to sync data</p>
                <p>Here you can see diferent examples to perform the attack</p>
                <p>When performing this attack remember to do it again for the subdomains</p>    
                <pre><code class="language-bash">dig axfr @DNS_IP #Try zone transfer without domain</code></pre>
                <pre><code class="language-bash">dig axfr @DNS_IP DOMAIN #Try zone transfer guessing the domain</code></pre> 
                <pre><code class="language-bash">fierce --domain DOMAIN --dns-servers DNS_IP #Will try toperform a zone transfer against every authoritative name server and if this doesn'twork, will launch a dictionary attack</code></pre>    
                </ul>    

                <h3>Subdomain takeover</h3>
                <ul>
                <p>Let's supose the following situation:</p>
                <p>A company has a external resource which is linked to a subdomain called blog.mycompany.com. This can be configured in the CNAME property of the DNS.</p>
                <p>In case this external resource becomes unavailable an attacker could create a new resource with the same domain and put it's own page</p>
                <p>Since the DNS of our company is still configured with the CNAME it will detect that the resource is now available and will resolve the attacker website</p>
                </ul> 

                <h3>Local DNS Cache Poisoning</h3>
                <ul>
                <p>This is a way of poisoning DNS of a victim to make the user resolve the address of the attacker instead of the real address that the user is requesting</p>
                <p>We can perform this with the tool etercap. First we need to setup the the domains we want to spoof by eding the following file</p>
                <pre><code class="language-bash">cat /etc/ettercap/etter.dns
inlanefreight.com      A   192.168.225.110
*.inlanefreight.com    A   192.168.225.110
#Domain to spoof       A   #Adress of the attacker</code></pre>
               
                <p>Then open ettercap and scan for hosts. Once you identified a target host and the gateway you need to set them in the ettercap application. Here i show you how</p>
                <p><b>Add target 1:</b> Victim computer</p>
                <p><b>Add target 2:</b> Gateway address</p>
                <p>Finally go to the plugin section and enable the dns_spoof to being poisoning</p>
                </ul> 

                <h3>Subdomain enumeration</h3>
                <ul>
                <p>Targeting the DNS server itself we can perform some bruteforcing using a tool called subbrute follow the steps</p>
                <p>Edit the /etc/host setting up the IP and doman of your target</p>
                <pre><code class="language-bash">192.168.4.6 targetdomain.com</code></pre>
                <p>Edit the file resolvers.txt located at the folder of subbrute and add the IP of the target server at the end. It's recommended to create new file. If not it will increase a lot the time of bruteforcing</p>
                <p>Finally use the following command. Have in mind that names.txt is the wordlist where all subdomains are</p>
                <pre><code class="language-bash">./subbrute.py -p inlanefreight.htb -s names.txt -r resolvers2.txt </code></pre>
                </ul>
            </ul>    
        </div>
    </div>
</body>
</html>